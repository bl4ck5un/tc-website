<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Flight Insurance Contract &#8212; Town Crier 1.0 documentation</title>
    
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Understand the Town Crier contract" href="tc-contract.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="flight-insurance-contract">
<h1>Flight Insurance Contract<a class="headerlink" href="#flight-insurance-contract" title="Permalink to this headline">¶</a></h1>
<p>The <code class="docutils literal"><span class="pre">Application</span></code> Contract above is only able to send queries to and receive responses from TC.
For many real-life applications there is one critical factor missing: <strong>timing</strong>.
A stock exchange contract which settles at a specified time needs to know the stock quote for that time.
A trip insurance contract which needs to find out whether a flight departs on time must fetch the flight state after the scheduled departure time.
A contract for the sale of a physical good has to wait for a period for delivery after payment to check whether the good was successfully delivered.
The immediate response TC currently supports cannot directly fulfill such requirements in these applications, but
developers can use other strategies to get around this limitation. (Future versions of TC will allow for pre-specified, future query times using the <code class="docutils literal"><span class="pre">timestamp</span></code> parameter.)</p>
<p>Here we present a design for a flight insurance application that illustrates use of the full existing range of TC features.</p>
<div class="section" id="application-setting">
<h2>Application setting<a class="headerlink" href="#application-setting" title="Permalink to this headline">¶</a></h2>
<p>Suppose Alice wants to set up a flight insurance service and creates a smart contract <code class="docutils literal"><span class="pre">FlightInsurance</span></code> for this purpose.
A user can buy a policy for his flight from Alice by sending money to the <code class="docutils literal"><span class="pre">FlightInsurance</span></code> Contract.
<code class="docutils literal"><span class="pre">FlightInsurance</span></code> offers a payout to the user should his insured flight be delayed or cancelled.
(Unfortunately, TC cannot detect whether you&#8217;ve been senselessly beaten and dragged off your flight by United Airlines.)</p>
</div>
<div class="section" id="problem-with-the-application-contract">
<h2>Problem with the <code class="docutils literal"><span class="pre">Application</span></code> Contract<a class="headerlink" href="#problem-with-the-application-contract" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal"><span class="pre">FlightInsurance</span></code> Contract contains the same five basic components found above in the <code class="docutils literal"><span class="pre">Application</span></code> Contract.
However, we don&#8217;t want to query TC immediately after a user, say Bob, purchases a policy. If we do so, this will result in one of two bad cases.
One is that Bob purchases a policy for a flight that has already been delayed or cancelled, which is unfair to Alice.
The other is that Bob purchases a policy before the scheduled departure time of his flight so when the <code class="docutils literal"><span class="pre">FlightInsurance</span></code> Contract queries immediately, it will get response of &#8220;not delayed&#8221; since the flight hasn&#8217;t yet left. This is unfair to Bob.</p>
</div>
<div class="section" id="a-scheme-to-get-around-the-problem">
<h2>A scheme to get around the problem<a class="headerlink" href="#a-scheme-to-get-around-the-problem" title="Permalink to this headline">¶</a></h2>
<p>To address this problem, we can separate the two operations and deal with them at different times.
The <code class="docutils literal"><span class="pre">FlightInsurance</span></code> Contract needs to include a <code class="docutils literal"><span class="pre">Insure()</span></code> function for a user to buy a policy for his flight a certain period ahead of the scheduled departure time, say 24 hours.
The contract can simply compare <code class="docutils literal"><span class="pre">block.timestamp</span></code> with the flight data to guarantee this restriction.
If the request is valid, then the contract will store the flight data and issue a policy ID to the user for querying TC later.
When the flight departs, the user can send a transaction to <code class="docutils literal"><span class="pre">Request()</span></code> with the policy ID in the <code class="docutils literal"><span class="pre">FlightInsurance</span></code> Contract, and the contract will query TC.
Then everything works much as in the <code class="docutils literal"><span class="pre">Application</span></code> Contract.</p>
<p>You can take a look at the <code class="docutils literal"><span class="pre">FlightInsurance.sol</span></code> for the complete <code class="docutils literal"><span class="pre">FlightInsurance</span></code> Contract logic.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Flight Insurance Contract</a><ul>
<li><a class="reference internal" href="#application-setting">Application setting</a></li>
<li><a class="reference internal" href="#problem-with-the-application-contract">Problem with the <code class="docutils literal"><span class="pre">Application</span></code> Contract</a></li>
<li><a class="reference internal" href="#a-scheme-to-get-around-the-problem">A scheme to get around the problem</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="tc-contract.html" title="previous chapter">Understand the <code class="docutils literal"><span class="pre">Town</span> <span class="pre">Crier</span></code> contract</a></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/flight-ins.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, Fan Zhang.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.5.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
      |
      <a href="_sources/flight-ins.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>